{"ast":null,"code":"import _objectSpread from \"C:/asa/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { AppTelaPadraoComponent } from '../shared/app-tela-padrao.component';\nimport { AppBarraAcoesCrudComponent } from '../shared/app-barra-acoes-crud.component';\nimport { AppPopupMessagesComponent } from '../shared/app-popup-messages.component';\nimport { PopupErrorBuilder } from '../shared/popup-error.builder';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/pontuacao-unidades.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction PontuacaoUnidadesPageComponent_div_18_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const pontuacao_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pontuacao_r7.nomeUnidade);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pontuacao_r7.pontosTotal);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pontuacao_r7.seloExcelencia ? \"Sim\" : \"Nao\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pontuacao_r7.trofeuMelhorUnidadeAno ? \"Sim\" : \"Nao\");\n  }\n}\nfunction PontuacaoUnidadesPageComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"table\")(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Unidade\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Pontos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Selo de excelencia\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Trofeu anual\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, PontuacaoUnidadesPageComponent_div_18_tr_13_Template, 9, 4, \"tr\", 19);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.pontuacoes);\n  }\n}\nfunction PontuacaoUnidadesPageComponent_ng_template_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtext(1, \"Nenhuma pontuacao encontrada para o periodo.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PontuacaoUnidadesPageComponent_div_24_tr_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\")(4, \"input\", 22);\n    i0.ɵɵlistener(\"ngModelChange\", function PontuacaoUnidadesPageComponent_div_24_tr_9_Template_input_ngModelChange_4_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const config_r9 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(config_r9.pontos = $event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const config_r9 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(config_r9.descricao);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", config_r9.pontos)(\"name\", \"pontos_\" + config_r9.chave);\n  }\n}\nfunction PontuacaoUnidadesPageComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"table\")(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Atividade\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Pontos\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(8, \"tbody\");\n    i0.ɵɵtemplate(9, PontuacaoUnidadesPageComponent_div_24_tr_9_Template, 5, 3, \"tr\", 19);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.configuracoes);\n  }\n}\nfunction PontuacaoUnidadesPageComponent_ng_template_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtext(1, \"Nenhuma configuracao encontrada.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let PontuacaoUnidadesPageComponent = /*#__PURE__*/(() => {\n  var _PontuacaoUnidadesPageComponent;\n  class PontuacaoUnidadesPageComponent {\n    constructor(pontuacaoUnidadesService, router) {\n      this.pontuacaoUnidadesService = pontuacaoUnidadesService;\n      this.router = router;\n      this.carregando = false;\n      this.carregandoConfiguracoes = false;\n      this.periodoRelatorio = this.obterPeriodoAtual();\n      this.pontuacoes = [];\n      this.configuracoes = [];\n      this.configuracoesOriginais = [];\n      this.mensagensErro = [];\n      this.menuPai = 'Operacional';\n      this.titulo = 'Pontuacao das unidades';\n      this.subtitulo = 'Acompanhe pontuacao mensal, selos de excelencia e trofeu anual.';\n      this.comentarioDidatico = 'ajuste os pontos por atividade e acompanhe o desempenho mensal das unidades.';\n    }\n    ngOnInit() {\n      this.carregarConfiguracoes();\n      this.carregarPontuacoes();\n    }\n    aoBuscar() {\n      this.carregarPontuacoes();\n    }\n    aoNovo() {\n      this.periodoRelatorio = this.obterPeriodoAtual();\n      this.carregarPontuacoes();\n    }\n    aoSalvar() {\n      var _this$periodoRelatori;\n      const builder = new PopupErrorBuilder();\n      if (!((_this$periodoRelatori = this.periodoRelatorio) !== null && _this$periodoRelatori !== void 0 && _this$periodoRelatori.trim())) {\n        builder.adicionarMensagem('Informe o periodo.');\n      }\n      const invalido = this.configuracoes.some(config => config.pontos == null || config.pontos < 0);\n      if (invalido) {\n        builder.adicionarMensagem('Informe pontos validos para as atividades.');\n      }\n      if (builder.temMensagens()) {\n        this.mensagensErro = builder.construir();\n        return;\n      }\n      this.carregandoConfiguracoes = true;\n      this.pontuacaoUnidadesService.salvarConfiguracoes(this.configuracoes).subscribe({\n        next: configuracoes => {\n          this.carregandoConfiguracoes = false;\n          this.configuracoes = configuracoes;\n          this.configuracoesOriginais = configuracoes.map(config => _objectSpread({}, config));\n          this.carregarPontuacoes();\n        },\n        error: () => {\n          this.carregandoConfiguracoes = false;\n          this.mensagensErro = ['Nao foi possivel salvar as configuracoes de pontuacao.'];\n        }\n      });\n    }\n    aoCancelar() {\n      this.configuracoes = this.configuracoesOriginais.map(config => _objectSpread({}, config));\n      this.carregarPontuacoes();\n    }\n    aoExcluir() {\n      this.mensagensErro = ['Acao indisponivel nesta tela.'];\n    }\n    aoImprimir() {\n      window.print();\n    }\n    aoFechar() {\n      this.router.navigate(['/dashboard']);\n    }\n    carregarPontuacoes() {\n      var _this$periodoRelatori2;\n      if (!((_this$periodoRelatori2 = this.periodoRelatorio) !== null && _this$periodoRelatori2 !== void 0 && _this$periodoRelatori2.trim())) {\n        this.mensagensErro = ['Informe o periodo.'];\n        return;\n      }\n      this.carregando = true;\n      this.pontuacaoUnidadesService.listarPontuacoes(this.periodoRelatorio).subscribe({\n        next: pontuacoes => {\n          this.pontuacoes = pontuacoes;\n          this.carregando = false;\n        },\n        error: () => {\n          this.carregando = false;\n          this.mensagensErro = ['Nao foi possivel carregar a pontuacao das unidades.'];\n        }\n      });\n    }\n    carregarConfiguracoes() {\n      this.carregandoConfiguracoes = true;\n      this.pontuacaoUnidadesService.listarConfiguracoes().subscribe({\n        next: configuracoes => {\n          this.configuracoes = configuracoes;\n          this.configuracoesOriginais = configuracoes.map(config => _objectSpread({}, config));\n          this.carregandoConfiguracoes = false;\n        },\n        error: () => {\n          this.carregandoConfiguracoes = false;\n          this.mensagensErro = ['Nao foi possivel carregar as configuracoes de pontuacao.'];\n        }\n      });\n    }\n    limparMensagens() {\n      this.mensagensErro = [];\n    }\n    obterPeriodoAtual() {\n      const agora = new Date();\n      const mes = String(agora.getMonth() + 1).padStart(2, '0');\n      const ano = agora.getFullYear();\n      return `${mes}-${ano}`;\n    }\n  }\n  _PontuacaoUnidadesPageComponent = PontuacaoUnidadesPageComponent;\n  _PontuacaoUnidadesPageComponent.ɵfac = function PontuacaoUnidadesPageComponent_Factory(t) {\n    return new (t || _PontuacaoUnidadesPageComponent)(i0.ɵɵdirectiveInject(i1.PontuacaoUnidadesService), i0.ɵɵdirectiveInject(i2.Router));\n  };\n  _PontuacaoUnidadesPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _PontuacaoUnidadesPageComponent,\n    selectors: [[\"app-pontuacao-unidades-page\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 28,\n    vars: 17,\n    consts: [[3, \"menuPai\", \"titulo\", \"subtitulo\", \"comentarioDidatico\"], [\"barra-acoes\", \"\"], [3, \"desabilitarBuscar\", \"desabilitarNovo\", \"desabilitarSalvar\", \"desabilitarCancelar\", \"desabilitarExcluir\", \"desabilitarImprimir\", \"desabilitarFechar\", \"buscar\", \"novo\", \"salvar\", \"cancelar\", \"excluir\", \"imprimir\", \"fechar\"], [1, \"cartaoFormulario\"], [1, \"tituloSecao\"], [1, \"formularioPadrao\"], [1, \"gradeGrupo\"], [1, \"linhaFormulario\"], [\"for\", \"periodoRelatorio\", 1, \"rotuloCampo\"], [1, \"campoObrigatorio\"], [\"id\", \"periodoRelatorio\", \"name\", \"periodoRelatorio\", \"type\", \"text\", \"placeholder\", \"01-2026\", \"required\", \"\", 1, \"campoTexto\", 3, \"ngModel\", \"ngModelChange\"], [1, \"cartaoTabela\"], [1, \"cabecalhoFormulario\", \"cabecalhoTabela\"], [\"class\", \"tabelaPontuacao\", 4, \"ngIf\", \"ngIfElse\"], [\"semPontuacoes\", \"\"], [\"class\", \"tabelaConfiguracoes\", 4, \"ngIf\", \"ngIfElse\"], [\"semConfiguracoes\", \"\"], [3, \"mensagens\", \"fechar\"], [1, \"tabelaPontuacao\"], [4, \"ngFor\", \"ngForOf\"], [1, \"linhaVazia\"], [1, \"tabelaConfiguracoes\"], [\"type\", \"number\", \"min\", \"0\", 1, \"campoTexto\", \"campoPontos\", 3, \"ngModel\", \"name\", \"ngModelChange\"]],\n    template: function PontuacaoUnidadesPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"app-tela-padrao\", 0)(1, \"div\", 1)(2, \"app-barra-acoes-crud\", 2);\n        i0.ɵɵlistener(\"buscar\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_buscar_2_listener() {\n          return ctx.aoBuscar();\n        })(\"novo\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_novo_2_listener() {\n          return ctx.aoNovo();\n        })(\"salvar\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_salvar_2_listener() {\n          return ctx.aoSalvar();\n        })(\"cancelar\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_cancelar_2_listener() {\n          return ctx.aoCancelar();\n        })(\"excluir\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_excluir_2_listener() {\n          return ctx.aoExcluir();\n        })(\"imprimir\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_imprimir_2_listener() {\n          return ctx.aoImprimir();\n        })(\"fechar\", function PontuacaoUnidadesPageComponent_Template_app_barra_acoes_crud_fechar_2_listener() {\n          return ctx.aoFechar();\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 3)(4, \"h3\", 4);\n        i0.ɵɵtext(5, \"Periodo de pontuacao\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"form\", 5)(7, \"div\", 6)(8, \"div\", 7)(9, \"label\", 8);\n        i0.ɵɵtext(10, \"Periodo (MM-AAAA) \");\n        i0.ɵɵelementStart(11, \"span\", 9);\n        i0.ɵɵtext(12, \"*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(13, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function PontuacaoUnidadesPageComponent_Template_input_ngModelChange_13_listener($event) {\n          return ctx.periodoRelatorio = $event;\n        });\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(14, \"div\", 11)(15, \"div\", 12)(16, \"h3\", 4);\n        i0.ɵɵtext(17, \"Pontuacao das unidades\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(18, PontuacaoUnidadesPageComponent_div_18_Template, 14, 1, \"div\", 13);\n        i0.ɵɵtemplate(19, PontuacaoUnidadesPageComponent_ng_template_19_Template, 2, 0, \"ng-template\", null, 14, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"div\", 3)(22, \"h3\", 4);\n        i0.ɵɵtext(23, \"Configuracao de pontos por atividade\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(24, PontuacaoUnidadesPageComponent_div_24_Template, 10, 1, \"div\", 15);\n        i0.ɵɵtemplate(25, PontuacaoUnidadesPageComponent_ng_template_25_Template, 2, 0, \"ng-template\", null, 16, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(27, \"app-popup-messages\", 17);\n        i0.ɵɵlistener(\"fechar\", function PontuacaoUnidadesPageComponent_Template_app_popup_messages_fechar_27_listener() {\n          return ctx.limparMensagens();\n        });\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(20);\n        const _r4 = i0.ɵɵreference(26);\n        i0.ɵɵproperty(\"menuPai\", ctx.menuPai)(\"titulo\", ctx.titulo)(\"subtitulo\", ctx.subtitulo)(\"comentarioDidatico\", ctx.comentarioDidatico);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"desabilitarBuscar\", ctx.carregando || ctx.carregandoConfiguracoes)(\"desabilitarNovo\", ctx.carregando || ctx.carregandoConfiguracoes)(\"desabilitarSalvar\", ctx.carregandoConfiguracoes)(\"desabilitarCancelar\", ctx.carregandoConfiguracoes)(\"desabilitarExcluir\", true)(\"desabilitarImprimir\", ctx.carregando)(\"desabilitarFechar\", false);\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngModel\", ctx.periodoRelatorio);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.pontuacoes.length > 0)(\"ngIfElse\", _r1);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuracoes.length > 0)(\"ngIfElse\", _r4);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"mensagens\", ctx.mensagensErro);\n      }\n    },\n    dependencies: [CommonModule, i3.NgForOf, i3.NgIf, FormsModule, i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.RequiredValidator, i4.MinValidator, i4.NgModel, i4.NgForm, AppTelaPadraoComponent, AppBarraAcoesCrudComponent, AppPopupMessagesComponent],\n    styles: [\".cartaoFormulario[_ngcontent-%COMP%], .cartaoTabela[_ngcontent-%COMP%]{background-color:#fff;border-radius:16px;border:1px solid #e1e5e1;padding:20px;box-shadow:0 6px 16px #0000000a}.tituloSecao[_ngcontent-%COMP%]{margin:0 0 16px;font-size:18px;font-weight:700}.cabecalhoFormulario[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.formularioPadrao[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.gradeGrupo[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.linhaFormulario[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.rotuloCampo[_ngcontent-%COMP%]{font-size:13px;color:#3a463a}.campoObrigatorio[_ngcontent-%COMP%]{color:#b91c1c}.campoTexto[_ngcontent-%COMP%]{border:1px solid #d8ddd8;border-radius:10px;padding:10px 12px;font-size:14px}.campoTexto[_ngcontent-%COMP%]:focus{outline:none;border-color:#2f7a45;box-shadow:0 0 0 3px #2f7a4526}.tabelaPontuacao[_ngcontent-%COMP%]   table[_ngcontent-%COMP%], .tabelaConfiguracoes[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}.tabelaPontuacao[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabelaPontuacao[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .tabelaConfiguracoes[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabelaConfiguracoes[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid #e5e7eb;text-align:left}.campoPontos[_ngcontent-%COMP%]{max-width:120px}.linhaVazia[_ngcontent-%COMP%]{text-align:center;color:#7b857b;padding:16px}\"]\n  });\n  return PontuacaoUnidadesPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}