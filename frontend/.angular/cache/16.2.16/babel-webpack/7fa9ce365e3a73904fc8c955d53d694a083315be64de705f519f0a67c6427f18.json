{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { AppTelaPadraoComponent } from '../shared/app-tela-padrao.component';\nimport { AppBarraAcoesCrudComponent } from '../shared/app-barra-acoes-crud.component';\nimport { AppPopupMessagesComponent } from '../shared/app-popup-messages.component';\nimport { PopupErrorBuilder } from '../shared/popup-error.builder';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/configuracoes-gerais.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/router\";\nfunction ConfiguracoesGeraisPageComponent_div_45_tr_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const registro_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(registro_r4.versao);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(registro_r4.dataHora);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(registro_r4.mudancas);\n  }\n}\nfunction ConfiguracoesGeraisPageComponent_div_45_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27)(1, \"table\")(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Versao\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Data/Hora\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Mudancas\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(10, \"tbody\");\n    i0.ɵɵtemplate(11, ConfiguracoesGeraisPageComponent_div_45_tr_11_Template, 7, 3, \"tr\", 28);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.historicoVersoes);\n  }\n}\nfunction ConfiguracoesGeraisPageComponent_ng_template_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29);\n    i0.ɵɵtext(1, \"Nenhum registro de versao encontrado.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ConfiguracoesGeraisPageComponent = /*#__PURE__*/(() => {\n  var _ConfiguracoesGeraisPageComponent;\n  class ConfiguracoesGeraisPageComponent {\n    constructor(configuracoesGeraisService) {\n      this.configuracoesGeraisService = configuracoesGeraisService;\n      this.menuPai = 'Configuracoes';\n      this.titulo = 'Configuracoes Gerais';\n      this.subtitulo = 'Controle de versao e historico de alteracoes do sistema.';\n      this.comentarioDidatico = 'registre versao, data/hora e mudancas.';\n      this.versaoAtual = '1.00.0';\n      this.historicoVersoes = [];\n      this.novaVersao = this.criarRegistroVazio();\n      this.mensagensErro = [];\n      this.carregando = false;\n    }\n    ngOnInit() {\n      this.carregarHistorico();\n    }\n    aoBuscar() {\n      this.carregarHistorico();\n    }\n    aoNovo() {\n      this.novaVersao = this.criarRegistroVazio();\n    }\n    aoSalvar() {\n      const builder = new PopupErrorBuilder();\n      if (!this.novaVersao.versao.trim()) {\n        builder.adicionarMensagem('Informe a versao no formato 1.00.0.');\n      } else if (!this.validarFormatoVersao(this.novaVersao.versao)) {\n        builder.adicionarMensagem('Formato de versao invalido. Use 1.00.0.');\n      } else if (!this.validarSequencia(this.novaVersao.versao)) {\n        builder.adicionarMensagem('A versao deve incrementar apenas o ultimo grupo.');\n      }\n      if (!this.novaVersao.dataHora.trim()) {\n        builder.adicionarMensagem('Informe a data e hora.');\n      }\n      if (!this.novaVersao.mudancas.trim()) {\n        builder.adicionarMensagem('Informe as mudancas.');\n      }\n      if (builder.temMensagens()) {\n        this.mensagensErro = builder.construir();\n        return;\n      }\n      this.configuracoesGeraisService.criar(this.novaVersao).subscribe({\n        next: () => {\n          this.novaVersao = this.criarRegistroVazio();\n          this.carregarHistorico();\n        },\n        error: () => {\n          this.mensagensErro = ['Nao foi possivel salvar a versao.'];\n        }\n      });\n    }\n    aoCancelar() {\n      this.novaVersao = this.criarRegistroVazio();\n    }\n    aoExcluir() {\n      if (this.historicoVersoes.length === 0) {\n        this.mensagensErro = ['Nao ha registros para excluir.'];\n        return;\n      }\n      const registro = this.historicoVersoes[0];\n      if (!registro.id) {\n        this.mensagensErro = ['Nao foi possivel excluir o registro.'];\n        return;\n      }\n      this.configuracoesGeraisService.excluir(registro.id).subscribe({\n        next: () => this.carregarHistorico(),\n        error: () => {\n          this.mensagensErro = ['Nao foi possivel excluir o registro.'];\n        }\n      });\n    }\n    aoImprimir() {\n      window.print();\n    }\n    aoFechar() {}\n    limparMensagens() {\n      this.mensagensErro = [];\n    }\n    definirDataHoraAtual() {\n      const agora = new Date();\n      const data = agora.toLocaleDateString('pt-BR');\n      const hora = agora.toLocaleTimeString('pt-BR', {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n      this.novaVersao.dataHora = `${data} ${hora}`;\n    }\n    carregarHistorico() {\n      this.carregando = true;\n      this.configuracoesGeraisService.listar().subscribe({\n        next: historico => {\n          var _this$historicoVersoe;\n          this.historicoVersoes = historico;\n          this.versaoAtual = ((_this$historicoVersoe = this.historicoVersoes[0]) === null || _this$historicoVersoe === void 0 ? void 0 : _this$historicoVersoe.versao) || '1.00.0';\n          this.carregando = false;\n        },\n        error: () => {\n          this.carregando = false;\n          this.mensagensErro = ['Nao foi possivel carregar o historico.'];\n        }\n      });\n    }\n    validarFormatoVersao(versao) {\n      return /^\\d+\\.\\d{2}\\.\\d+$/.test(versao);\n    }\n    validarSequencia(versao) {\n      var _this$historicoVersoe2;\n      const ultima = (_this$historicoVersoe2 = this.historicoVersoes[0]) === null || _this$historicoVersoe2 === void 0 ? void 0 : _this$historicoVersoe2.versao;\n      if (!ultima) {\n        return true;\n      }\n      const partesNova = versao.split('.').map(Number);\n      const partesUltima = ultima.split('.').map(Number);\n      if (partesNova.length !== 3 || partesUltima.length !== 3) {\n        return false;\n      }\n      return partesNova[0] === partesUltima[0] && partesNova[1] === partesUltima[1] && partesNova[2] === partesUltima[2] + 1;\n    }\n    criarRegistroVazio() {\n      return {\n        versao: '',\n        dataHora: '',\n        mudancas: ''\n      };\n    }\n  }\n  _ConfiguracoesGeraisPageComponent = ConfiguracoesGeraisPageComponent;\n  _ConfiguracoesGeraisPageComponent.ɵfac = function ConfiguracoesGeraisPageComponent_Factory(t) {\n    return new (t || _ConfiguracoesGeraisPageComponent)(i0.ɵɵdirectiveInject(i1.ConfiguracoesGeraisService));\n  };\n  _ConfiguracoesGeraisPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _ConfiguracoesGeraisPageComponent,\n    selectors: [[\"app-configuracoes-gerais-page\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 49,\n    vars: 18,\n    consts: [[3, \"menuPai\", \"titulo\", \"subtitulo\", \"comentarioDidatico\"], [\"barra-acoes\", \"\"], [3, \"desabilitarBuscar\", \"desabilitarNovo\", \"desabilitarSalvar\", \"desabilitarCancelar\", \"desabilitarExcluir\", \"desabilitarImprimir\", \"desabilitarFechar\", \"buscar\", \"novo\", \"salvar\", \"cancelar\", \"excluir\", \"imprimir\"], [1, \"cartaoFormulario\"], [1, \"tituloSecao\"], [1, \"linhaVersaoAtual\"], [1, \"rotuloCampo\"], [1, \"linhaAcoesConfig\"], [\"routerLink\", \"/configuracoes-gerais/usuarios\", 1, \"botaoPrimarioLink\"], [\"routerLink\", \"/configuracoes-gerais/aprovacao-usuarios\", 1, \"botaoPrimarioLink\"], [1, \"formularioPadrao\"], [1, \"gradeGrupo\"], [1, \"linhaFormulario\"], [\"for\", \"versaoNova\", 1, \"rotuloCampo\"], [1, \"campoObrigatorio\"], [\"id\", \"versaoNova\", \"name\", \"versaoNova\", \"type\", \"text\", \"placeholder\", \"1.00.0\", \"required\", \"\", 1, \"campoTexto\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"dataHora\", 1, \"rotuloCampo\"], [1, \"linhaDataHora\"], [\"id\", \"dataHora\", \"name\", \"dataHora\", \"type\", \"text\", \"placeholder\", \"dd/MM/yyyy HH:mm\", \"required\", \"\", 1, \"campoTexto\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"button\", 1, \"botaoAcao\", 3, \"click\"], [1, \"linhaFormulario\", \"linhaTextoGrande\"], [\"for\", \"mudancas\", 1, \"rotuloCampo\"], [\"id\", \"mudancas\", \"name\", \"mudancas\", \"rows\", \"3\", \"placeholder\", \"Descreva as mudancas de forma objetiva\", \"required\", \"\", 1, \"campoTexto\", \"campoTextoEndereco\", 3, \"ngModel\", \"ngModelChange\"], [1, \"cartaoTabela\"], [\"class\", \"tabelaVersoes\", 4, \"ngIf\", \"ngIfElse\"], [\"semVersoes\", \"\"], [3, \"mensagens\", \"fechar\"], [1, \"tabelaVersoes\"], [4, \"ngFor\", \"ngForOf\"], [1, \"linhaVazia\"]],\n    template: function ConfiguracoesGeraisPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"app-tela-padrao\", 0)(1, \"div\", 1)(2, \"app-barra-acoes-crud\", 2);\n        i0.ɵɵlistener(\"buscar\", function ConfiguracoesGeraisPageComponent_Template_app_barra_acoes_crud_buscar_2_listener() {\n          return ctx.aoBuscar();\n        })(\"novo\", function ConfiguracoesGeraisPageComponent_Template_app_barra_acoes_crud_novo_2_listener() {\n          return ctx.aoNovo();\n        })(\"salvar\", function ConfiguracoesGeraisPageComponent_Template_app_barra_acoes_crud_salvar_2_listener() {\n          return ctx.aoSalvar();\n        })(\"cancelar\", function ConfiguracoesGeraisPageComponent_Template_app_barra_acoes_crud_cancelar_2_listener() {\n          return ctx.aoCancelar();\n        })(\"excluir\", function ConfiguracoesGeraisPageComponent_Template_app_barra_acoes_crud_excluir_2_listener() {\n          return ctx.aoExcluir();\n        })(\"imprimir\", function ConfiguracoesGeraisPageComponent_Template_app_barra_acoes_crud_imprimir_2_listener() {\n          return ctx.aoImprimir();\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 3)(4, \"h3\", 4);\n        i0.ɵɵtext(5, \"Versao Atual\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 5)(7, \"span\", 6);\n        i0.ɵɵtext(8, \"Versao em producao:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"strong\");\n        i0.ɵɵtext(10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(11, \"div\", 7)(12, \"a\", 8);\n        i0.ɵɵtext(13, \"Gerenciar usuarios\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"a\", 9);\n        i0.ɵɵtext(15, \"Aprovacao de usuarios\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(16, \"div\", 3)(17, \"h3\", 4);\n        i0.ɵɵtext(18, \"Registro de Nova Versao\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"form\", 10)(20, \"div\", 11)(21, \"div\", 12)(22, \"label\", 13);\n        i0.ɵɵtext(23, \"Versao (formato 1.00.0) \");\n        i0.ɵɵelementStart(24, \"span\", 14);\n        i0.ɵɵtext(25, \"*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(26, \"input\", 15);\n        i0.ɵɵlistener(\"ngModelChange\", function ConfiguracoesGeraisPageComponent_Template_input_ngModelChange_26_listener($event) {\n          return ctx.novaVersao.versao = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(27, \"div\", 12)(28, \"label\", 16);\n        i0.ɵɵtext(29, \"Data e hora \");\n        i0.ɵɵelementStart(30, \"span\", 14);\n        i0.ɵɵtext(31, \"*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(32, \"div\", 17)(33, \"input\", 18);\n        i0.ɵɵlistener(\"ngModelChange\", function ConfiguracoesGeraisPageComponent_Template_input_ngModelChange_33_listener($event) {\n          return ctx.novaVersao.dataHora = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"button\", 19);\n        i0.ɵɵlistener(\"click\", function ConfiguracoesGeraisPageComponent_Template_button_click_34_listener() {\n          return ctx.definirDataHoraAtual();\n        });\n        i0.ɵɵtext(35, \"Agora\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(36, \"div\", 20)(37, \"label\", 21);\n        i0.ɵɵtext(38, \"Mudancas \");\n        i0.ɵɵelementStart(39, \"span\", 14);\n        i0.ɵɵtext(40, \"*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(41, \"textarea\", 22);\n        i0.ɵɵlistener(\"ngModelChange\", function ConfiguracoesGeraisPageComponent_Template_textarea_ngModelChange_41_listener($event) {\n          return ctx.novaVersao.mudancas = $event;\n        });\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(42, \"div\", 23)(43, \"h3\", 4);\n        i0.ɵɵtext(44, \"Historico de Versoes\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(45, ConfiguracoesGeraisPageComponent_div_45_Template, 12, 1, \"div\", 24);\n        i0.ɵɵtemplate(46, ConfiguracoesGeraisPageComponent_ng_template_46_Template, 2, 0, \"ng-template\", null, 25, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(48, \"app-popup-messages\", 26);\n        i0.ɵɵlistener(\"fechar\", function ConfiguracoesGeraisPageComponent_Template_app_popup_messages_fechar_48_listener() {\n          return ctx.limparMensagens();\n        });\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(47);\n        i0.ɵɵproperty(\"menuPai\", ctx.menuPai)(\"titulo\", ctx.titulo)(\"subtitulo\", ctx.subtitulo)(\"comentarioDidatico\", ctx.comentarioDidatico);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"desabilitarBuscar\", ctx.carregando)(\"desabilitarNovo\", ctx.carregando)(\"desabilitarSalvar\", ctx.carregando)(\"desabilitarCancelar\", ctx.carregando)(\"desabilitarExcluir\", ctx.carregando || ctx.historicoVersoes.length === 0)(\"desabilitarImprimir\", ctx.carregando)(\"desabilitarFechar\", true);\n        i0.ɵɵadvance(8);\n        i0.ɵɵtextInterpolate(ctx.versaoAtual);\n        i0.ɵɵadvance(16);\n        i0.ɵɵproperty(\"ngModel\", ctx.novaVersao.versao);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.novaVersao.dataHora);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngModel\", ctx.novaVersao.mudancas);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.historicoVersoes.length > 0)(\"ngIfElse\", _r1);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"mensagens\", ctx.mensagensErro);\n      }\n    },\n    dependencies: [CommonModule, i2.NgForOf, i2.NgIf, FormsModule, i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.RequiredValidator, i3.NgModel, i3.NgForm, RouterModule, i4.RouterLink, AppTelaPadraoComponent, AppBarraAcoesCrudComponent, AppPopupMessagesComponent],\n    styles: [\".cartaoFormulario[_ngcontent-%COMP%], .cartaoTabela[_ngcontent-%COMP%]{background-color:#fff;border-radius:16px;border:1px solid #e1e5e1;padding:20px;box-shadow:0 6px 16px #0000000a}.tituloSecao[_ngcontent-%COMP%]{margin:0 0 16px;font-size:18px;font-weight:700}.formularioPadrao[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.gradeGrupo[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.linhaFormulario[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.linhaTextoGrande[_ngcontent-%COMP%]{grid-column:1 / -1}.rotuloCampo[_ngcontent-%COMP%]{font-size:13px;color:#3a463a}.campoObrigatorio[_ngcontent-%COMP%]{color:#b91c1c}.campoTexto[_ngcontent-%COMP%]{border:1px solid #d8ddd8;border-radius:10px;padding:10px 12px;font-size:14px}.campoTextoEndereco[_ngcontent-%COMP%]{min-height:40px;resize:vertical}.linhaVersaoAtual[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;font-size:15px}.linhaAcoesConfig[_ngcontent-%COMP%]{margin-top:12px}.botaoPrimarioLink[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;background-color:#2f7a45;color:#fff;border-radius:10px;padding:8px 14px;font-size:13px;font-weight:700;text-decoration:none}.linhaDataHora[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.botaoAcao[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid #d8ddd8;background-color:#fff;color:#2e3a2e;border-radius:8px;padding:8px 12px;font-weight:600;font-size:13px;cursor:pointer}.tabelaVersoes[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}.tabelaVersoes[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabelaVersoes[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid #e5e7eb;text-align:left}.linhaVazia[_ngcontent-%COMP%]{text-align:center;color:#7b857b;padding:16px}\"]\n  });\n  return ConfiguracoesGeraisPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}