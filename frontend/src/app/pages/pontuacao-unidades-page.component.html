<app-tela-padrao
  [menuPai]="menuPai"
  [titulo]="titulo"
  [subtitulo]="subtitulo"
  [comentarioDidatico]="comentarioDidatico"
>
  <div barra-acoes>
    <app-barra-acoes-crud
      [desabilitarBuscar]="carregando || carregandoConfiguracoes"
      [desabilitarNovo]="carregando || carregandoConfiguracoes"
      [desabilitarSalvar]="carregandoConfiguracoes"
      [desabilitarCancelar]="carregandoConfiguracoes"
      [desabilitarExcluir]="true"
      [desabilitarImprimir]="carregando"
      [desabilitarFechar]="false"
      (buscar)="aoBuscar()"
      (novo)="aoNovo()"
      (salvar)="aoSalvar()"
      (cancelar)="aoCancelar()"
      (excluir)="aoExcluir()"
      (imprimir)="aoImprimir()"
      (fechar)="aoFechar()"
    ></app-barra-acoes-crud>
  </div>

  <div class="abasPadrao">
    <button
      type="button"
      class="abaPadrao"
      [ngClass]="{ abaAtiva: abaAtiva === 'pontuacao' }"
      (click)="abaAtiva = 'pontuacao'"
    >
      Pontuacao das unidades
    </button>
    <button
      type="button"
      class="abaPadrao"
      [ngClass]="{ abaAtiva: abaAtiva === 'selos' }"
      (click)="abaAtiva = 'selos'"
    >
      Selos por unidade
    </button>
    <button
      type="button"
      class="abaPadrao"
      [ngClass]="{ abaAtiva: abaAtiva === 'configuracoes' }"
      (click)="abaAtiva = 'configuracoes'"
    >
      Configuracao de pontos
    </button>
  </div>

  <div class="cartaoTabela" *ngIf="abaAtiva === 'pontuacao'">
    <div class="cabecalhoFormulario cabecalhoTabela">
      <h3 class="tituloSecao">Pontuacao das unidades</h3>
    </div>
    <div class="tabelaPontuacao" *ngIf="pontuacoesMensais.length > 0; else semPontuacoes">
      <table>
        <thead>
          <tr>
            <th>Unidade</th>
            <th *ngFor="let mes of mesesPontuacao; let i = index" [class.mesAtual]="i === 0">{{ mes.rotulo }}</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let linha of pontuacoesMensais">
            <td class="colunaUnidade">{{ linha.nomeUnidade }}</td>
            <td
              *ngFor="let pontosMes of linha.pontosPorMes; let i = index"
              class="colunaMes"
              [class.mesAtual]="i === 0"
            >
              {{ pontosMes }}
            </td>
            <td class="colunaTotal">{{ linha.totalAno }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #semPontuacoes>
      <div class="linhaVazia">Nenhuma pontuacao encontrada para o periodo.</div>
    </ng-template>
  </div>

  <div class="cartaoTabela" *ngIf="abaAtiva === 'selos'">
    <div class="cabecalhoFormulario cabecalhoTabela">
      <h3 class="tituloSecao">Selos por unidade ({{ anoReferencia }})</h3>
    </div>
    <div class="tabelaSelos" *ngIf="pontuacoes.length > 0; else semSelos">
      <table>
        <thead>
          <tr>
            <th>Unidade</th>
            <th *ngFor="let mes of mesesAno">{{ mes.rotulo }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let pontuacao of pontuacoes">
            <td class="colunaUnidade">{{ pontuacao.nomeUnidade }}</td>
            <td *ngFor="let selo of obterSelosDaUnidade(pontuacao.nomeUnidade); let i = index" class="colunaSelo">
              <img
                *ngIf="selo; else semSelo"
                [src]="urlImagemSelo"
                [alt]="'Selo ' + mesesAno[i].rotulo"
                class="imagemSelo"
              />
              <ng-template #semSelo>
                <span class="marcadorSemSelo" aria-label="Sem selo">X</span>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #semSelos>
      <div class="linhaVazia">Nenhuma unidade encontrada para exibir os selos.</div>
    </ng-template>
  </div>

  <div class="cartaoFormulario" *ngIf="abaAtiva === 'configuracoes'">
    <h3 class="tituloSecao">Configuracao de pontos por atividade</h3>
    <div class="tabelaConfiguracoes" *ngIf="configuracoes.length > 0; else semConfiguracoes">
      <table>
        <thead>
          <tr>
            <th>Atividade</th>
            <th>Pontos</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let config of configuracoes">
            <td>{{ config.descricao }}</td>
            <td>
              <input
                type="number"
                class="campoTexto campoPontos"
                min="0"
                [(ngModel)]="config.pontos"
                [name]="'pontos_' + config.chave"
              />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #semConfiguracoes>
      <div class="linhaVazia">Nenhuma configuracao encontrada.</div>
    </ng-template>
  </div>
</app-tela-padrao>

<app-popup-messages
  [mensagens]="mensagensErro"
  (fechar)="limparMensagens()"
></app-popup-messages>
