<app-tela-padrao
  [menuPai]="menuPai"
  [titulo]="titulo"
  [subtitulo]="subtitulo"
  [comentarioDidatico]="comentarioDidatico"
>
  <div class="gradeBackup">
    <div class="cartaoBackup">
      <h3 class="tituloSecao">Gerar Backup</h3>
      <p class="descricaoSecao">Gera um arquivo completo (.sql) com as tabelas atuais do sistema.</p>
      <button type="button" class="botaoAcao botaoPrimario" (click)="aoSalvar()" [disabled]="carregandoBackup">
        {{ carregandoBackup ? 'Gerando...' : 'Gerar e Baixar Backup' }}
      </button>
    </div>

    <div class="cartaoBackup">
      <h3 class="tituloSecao">Testar Restauracao</h3>
      <p class="descricaoSecao">Valida o arquivo selecionado executando a restauracao em transacao com ROLLBACK.</p>
      <input type="file" accept=".sql" class="campoArquivo" (change)="selecionarArquivo($event)" />
      <button type="button" class="botaoAcao" (click)="testarRestauracao()" [disabled]="carregandoTeste">
        {{ carregandoTeste ? 'Testando...' : 'Testar Backup' }}
      </button>
    </div>

    <div class="cartaoBackup cartaoAlerta">
      <h3 class="tituloSecao">Restauracao Geral</h3>
      <p class="descricaoSecao">Substitui os dados atuais pelo conteudo do arquivo selecionado.</p>
      <input type="file" accept=".sql" class="campoArquivo" (change)="selecionarArquivo($event)" />
      <button type="button" class="botaoAcao botaoPerigo" (click)="restaurarBackup()" [disabled]="carregandoRestauracao">
        {{ carregandoRestauracao ? 'Restaurando...' : 'Restaurar Backup' }}
      </button>
    </div>
  </div>

  <div class="cartaoTabela">
    <div class="cabecalhoTabela">
      <h3 class="tituloSecao">Historico de Backups</h3>
      <span class="badge">{{ logs.length }} registros</span>
    </div>
    <div class="tabelaHistorico" *ngIf="logs.length > 0; else semLogs">
      <table>
        <thead>
          <tr>
            <th>Data/Hora</th>
            <th>Tipo</th>
            <th>Arquivo</th>
            <th>Tamanho</th>
            <th>Status</th>
            <th>Mensagem</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of logs">
            <td>{{ log.dataHora }}</td>
            <td>{{ log.tipo }}</td>
            <td>{{ log.arquivoNome || '-' }}</td>
            <td>{{ formatarTamanho(log.tamanhoBytes) }}</td>
            <td>
              <span class="tagStatus" [class.tagSucesso]="log.status === 'SUCESSO'" [class.tagErro]="log.status !== 'SUCESSO'">
                {{ log.status }}
              </span>
            </td>
            <td>{{ log.mensagem || '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #semLogs>
      <div class="estadoVazio">Nenhum backup registrado ainda.</div>
    </ng-template>
  </div>
</app-tela-padrao>

<app-popup-messages
  [mensagens]="mensagensErro"
  (fechar)="limparMensagens()"
></app-popup-messages>
